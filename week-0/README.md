## Диаграмма

Диаграмма сделана в draw.io, пошарена через гугл-диск.

https://drive.google.com/file/d/182GDiKQK671XVKeT5kFtfAY3E7J5Uq20/view?usp=sharing

## Общая концепция
Система разделена на несколько подсистем:
- Аутентификация и авторизация
- Клиентская часть для того, чтобы коты-клиенты могли сформировать заказ, посмотреть историю, внести деньги, просмотреть инвойсы и т.д.
- Админка для менеджеров, чтобы они могли внести изменения в типы услуг, разобраться с косяками воркеров
- Часть для котов-воркеров, где они будут видеть свои заказы, заработанные деньги и т.д.
- Есть отдел расходников со своими сотрудниками и для них свой маленький кусочек системы
- Подсистема матчинга, т.к. там закрытый алгоритм

Для борьбы с DDOS запустим систему в облаке предоставляющем защиту, например Cloudflare

Подсистемы общаются между собой через Message Broker, чтобы каждая подсистема могла функционировать изолированно.

Подсистемы будут реализованы в виде отдельных сервисов, т.е. не прям микросервисы, но и не прям всё одним большим монолитом. В теории это всё будет не сложно деплоить. В перспективе отдельные части подсистем можно будет вынести в виде сервисов.

## Авторизация в системе
На схеме не показано, но все пользователе в системе должны быть авторизованы

## Роли в системе
- Клиент (коты-тестировщики или эталонный образец)
- Менеджеры (есть доступ к админке)
- Воркер (коты-воркеры или обычный образец)
- Сотрудник отдела расходников (доступ только к системе расходников)

## Система автоматического добавления котов-тестировщиков в качестве клиентов
Система "каким-то образом" получает из компании Happy Cat Box список котов-тестировщиков и загружает его в MCF. Новым записям автоматически присваивается роль клиента.

Пункт требует больше информации о том как можно получить список котов-тестировщиков из Happy Cat Box

## Почему были выбраны те или иные решения
### Почему именно такие части системы?
У нас по ТЗ есть явно разные flow для разных пользователей. Каждый flow лучше всего отделять в свой сервис или набор сервисов.

### Почему именно такая структура?
У меня микс вариант, потому что так есть крупные блоки, которые можно "уронить", но не пострадает другая часть системы. Уронили подсистему воркеров, то страдают только воркеры, а клиенты могут клепать новые заказы.

### Почему выбраны именно такие коммуникации?
Коммуникации между сервисами выполняются через message broker, потому что так достигается автономность отдельных подсистем. Главное, чтобы message broker не упал или если упал, то подсистема могла всё запродьюсить, когда он поднимется.

### Спорные решения
Баланс у каждой подсистемы свой. Я ему совсем не уделил внимания, но мне кажется в таком топорном варианте можно поймать проблемы с отрицательным балансом и ещё какими-то проблемами. Также никак не учёл систему скидок, штрафов.

Я в каждой подсистеме сделал так, что она сама отправляет почту, но возможно с учётом требований сделать общую подсистему отправки почты было бы лучше, но если она отвалится, то никто не получит почту, а так хотя бы часть будет работать.

Мне кажется надо с типами услуг более детально прорабатывать алгоритм, потому что их могут менять как угодно и надо сделать как-то чтобы услуга "тыгыдыкать" созданная вчера, сегодня удалённая, а послезавтра новая "тыгыдыкать" нормально матчились по всей системе и было понятно, что это какая-то старая одноимённая, а это новая.
