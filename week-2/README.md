## Схема

В этот раз я всё нарисовал на одной борде Miro

Слева у меня старый вариант из прошлой недели.

Справа новый вариант

Борда: https://miro.com/app/board/uXjVMGQbi88=/?share_link_id=378073822708

## Поддомены

Поддомены:
- Отдел тестирования котов
	- Конкурентное преимущество: да
	- Сложность: высокая
	- Изменчивость: высокая
	- Варианты реализации: ???
	- Интерес проблемы: высокий
	- Предполагаемый вид поддомена: core
- Матчинг воркеров на заказы (тут ещё и свои термины):
	- Конкурентное преимущество: да
	- Сложность: высокая
	- Изменчивость: высокая
	- Варианты реализации: ???
	- Интерес проблемы: высокий
	- Предполагаемый вид поддомена: core
- Отдел сборки расходников
	- Конкурентное преимущество: нет
	- Сложность: низкая
	- Изменчивость: низкая
	- Варианты реализации: купить готовое решение
	- Интерес проблемы: низкий
	- Предполагаемый вид поддомена: generic
- Печеньки из будущего
	- Конкурентное преимущество: нет
	- Сложность: низкая
	- Изменчивость: низкая
	- Варианты реализации: аутсорс (уже даже)
	- Интерес проблемы: низкий
	- Предполагаемый вид поддомена: generic
- Воркеры и их работа с системой
	- Конкурентное преимущество: нет
	- Сложность: средняя
	- Изменчивость: низкая
	- Варианты реализации: ???
	- Интерес проблемы: низкий
	- Предполагаемый вид поддомена: supporting
- Аудит заказов
	- Конкурентное преимущество: нет
	- Сложность: средняя
	- Изменчивость: низкая
	- Варианты реализации: ???
	- Интерес проблемы: средний
	- Предполагаемый вид поддомена: supporting
- Ставки на заказы (по сути оно как бы на 2 департамента - это аудит и тестирование, т.к. и там и там менеджеры)
	- Конкурентное преимущество: нет
	- Сложность: низкая
	- Изменчивость: низкая
	- Варианты реализации: может найдётся азино-которое-нельзя-называть, кто согласится с нами интегрироваться?
	- Интерес проблемы: низкий
	- Предполагаемый вид поддомена: generic
- Заказы от клиентов
	- Конкурентное преимущество: нет
	- Сложность: средняя
	- Изменчивость: низкая
	- Варианты реализации: ???
	- Интерес проблемы: низкий
	- Предполагаемый вид поддомена: supporting

### Bounded contexts

- Отдел тестирования котов
	- Предполагаемый вид поддомена: core
	- Выделенный боундед-контекст: Проведение тестирование котов и отбор лучших
- Матчинг воркеров на заказы (свои термины, поэтому точно существуют отдельно):
	- Предполагаемый вид поддомена: core
	- Выделенный боундед-контекст: Матчинг воркеров на заказы
- Отдел сборки расходников
	- Предполагаемый вид поддомена: generic
	- Выделенный боундед-контекст:
		- Сборка расходников
		- Заказ печенек
- Печеньки из будущего
	- Предполагаемый вид поддомена: generic
	- Выделенный боундед-контекст: Приготовить печеньку и отправить её в прошлое, чтобы успеть за 10 минут =)
- Воркеры и их работа с системой
	- Предполагаемый вид поддомена: supporting
	- Выделенный боундед-контекст:
		- Работа с заказами
		- Выплата денег
- Аудит заказов
	- Предполагаемый вид поддомена: supporting
	- Выделенный боундед-контекст: Проведение аудита заказов
- Ставки на заказы (по сути оно как бы на 2 департамента - это аудит и тестирование котов, т.к. и там и там менеджеры работают и участвуют)
	- Предполагаемый вид поддомена: generic
	- Выделенный боундед-контекст: Приём ставок и расчёт выигрыша
- Заказы от клиентов
	- Предполагаемый вид поддомена: supporting
	- Выделенный боундед-контекст:
		- Работа с заказами от клиентов
		- Списание денег за услуги

## Заметки по обновлённой ES
В первый раз у меня было очень много технических шагов. В этот раз я попытался сосредоточиться на сути. Например, суть аудита - это выполнять аудит, а то что все провальные должны пройти аудит, что надо звонить клиенту - это уже детали, которые не важны. Но важно то, что если проводили аудит провальных заказов, то это должно давать какие-то продуктовые гипотезы.

Собственно постарался всё разложить по таймлайну, убрать лишние связи и получилось определённо интересно. И по внутренним ощущениям оно должно работать и раскладываться на любой архитектурный стиль.

## Заметки про Date Model
Я в модели сознательно не стал рисовать стрелки между контекстами, чтобы не перегружать её.

## Заметки про Communication Model

В схеме коммуникаций оставлено только необходимое взаимодействие между контекстами.

Почти все действия асинхронные, кроме поиска воркера и отправки заказа во внешнюю систему, потому что нам критично заказать печеньку во внешней системе и также критично вытащить воркера, хотя у нас и есть допущение, что воркер всегда находится.

## Характеристики системы
Данный пункт я записал как поток мыслей.

Я сначала пробежался по ТЗ и выделил всё что похоже на характеристики, а потом уже собрал в один список. Итоговый список важных характеристик в конце пункта.

- [US-050] - не известно как будет вестить расчёт (изменчивость)
- [US-070] - agility, testability, deployability, scalability, availability и fault tolerance
- [US-081] - 1k/день заявок + защита от ddos (масштабирование + защита остальной части системы) (performance, availability, fault tolerance, testability, deployability, agility, security, scalability)
- [US-170] - небольшой намёк на вариативность, потому что сегодня печеньки, а завтра яблоки

Низкий TTM (agility, testability и deployability)

Нагрузка 10 заказов/день (слабая нагрузка, если подумать)

100 клиентов - раз это наши же сотрудники, то нужно максимально подумать об их удовлетворенности (performance, availability, fault tolerance, testability, deployability, agility и security)

20 воркеров (даже если это взять как на 1 воркера по 10 заказов в день, то это типа 200 запросов на начало выполнения заказа + 200 запросов на окончание + нотификации в системе на каждый чих)

> Для бизнеса критично проверять новые гипотезы по отсеву котов и изменять уже существующие с максимальной скоростью и надёжностью.

Это соответствует agility, testability и deployability, performance, availability, fault tolerance, testability, agility и security

Таким образом основные характеристики, которые прослеживаются:
- agility
- testability
- deployability
- performance
- availability
- fault tolerance
- security
- scalability

## Архитектурный стиль
На основе списка характеристик и приведённой таблицы в уроке, я бы выбрал микросервисы с асинхронным общением, потому что они очень хорошо закрывают потребности в изменчивости и устройчивости системы на раннем этапе.

1 домен - 1 сервис.

Делать 1 bounded-context = 1 сервис я бы пока не стал, т.к. появится необходимость синхронизировать данные внутри одного домена, а на начальном этапе - это сложно и дорого (хотя бизнес и говорит, что денег вагон, но всё же я не стал бы)

## Спорные моменты

Интересно, что на модели данных надо добавить Happy Cat Box, т.к. они являются владельцем данных о клиентах. Можно наверное на ES тоже добавить, но не уверен, что в этом есть смысл, т.к. это всего 1 квадратик "добавить нового клиента", который будет реагировать на событие внешней системы.

С заказом печенек такая же интересная история. В целом готовка печенек делегирована внешней системе. Наша же задача только отправить им заявку с информацией о клиенте и потом принять готовую продукцию, которая попадает в расходники. Чисто формально раз есть бизнес-процесс, то квадратик добавлю.

Я в целом за асинхронные коммуникации =) Ну просто интересно посмотреть куда в конечном счёте это приведёт в учебном проекте =)
